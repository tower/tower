
Tower.Support.String = {
  camelize_rx: /(?:^|_|\-)(.)/g,
  capitalize_rx: /(^|\s)([a-z])/g,
  underscore_rx1: /([A-Z]+)([A-Z][a-z])/g,
  underscore_rx2: /([a-z\d])([A-Z])/g,
  constantize: function(string, scope) {
    if (scope == null) {
      scope = global;
    }
    return scope[this.camelize(string)];
  },
  camelize: function(string, firstLetterLower) {
    string = string.replace(this.camelize_rx, function(str, p1) {
      return p1.toUpperCase();
    });
    if (firstLetterLower) {
      return string.substr(0, 1).toLowerCase() + string.substr(1);
    } else {
      return string;
    }
  },
  underscore: function(string) {
    return string.replace(this.underscore_rx1, '$1_$2').replace(this.underscore_rx2, '$1_$2').replace('-', '_').toLowerCase();
  },
  singularize: function(string) {
    var len;
    len = string.length;
    if (string.substr(len - 3) === 'ies') {
      return string.substr(0, len - 3) + 'y';
    } else if (string.substr(len - 1) === 's') {
      return string.substr(0, len - 1);
    } else {
      return string;
    }
  },
  pluralize: function(count, string) {
    var lastLetter, len;
    if (string) {
      if (count === 1) {
        return string;
      }
    } else {
      string = count;
    }
    len = string.length;
    lastLetter = string.substr(len - 1);
    if (lastLetter === 'y') {
      return "" + (string.substr(0, len - 1)) + "ies";
    } else if (lastLetter === 's') {
      return string;
    } else {
      return "" + string + "s";
    }
  },
  capitalize: function(string) {
    return string.replace(this.capitalize_rx, function(m, p1, p2) {
      return p1 + p2.toUpperCase();
    });
  },
  trim: function(string) {
    if (string) {
      return string.trim();
    } else {
      return "";
    }
  },
  interpolate: function(stringOrObject, keys) {
    var key, string, value;
    if (typeof stringOrObject === 'object') {
      string = stringOrObject[keys.count];
      if (!string) {
        string = stringOrObject['other'];
      }
    } else {
      string = stringOrObject;
    }
    for (key in keys) {
      value = keys[key];
      string = string.replace(new RegExp("%\\{" + key + "\\}", "g"), value);
    }
    return string;
  },
  grep: function(object, regex, iterator, context) {
    var found;
    regex = _.isRegExp(regex) ? regex : RegExp(String(regex).replace(/([{.(|}:)$+?=^*!\/[\]\\])/g, "\\$1"));
    found = _.select(object, function(s) {
      return regex.test(s);
    }, context);
    if (iterator) {
      return _.map(found, iterator, context);
    }
    return found;
  },
  parameterize: function(string) {
    return Tower.Support.String.underscore(string).replace(/[^a-z0-9]+/g, "-").replace(/^-+|-+$/g, '');
  }
};

module.exports = Tower.Support.String;
